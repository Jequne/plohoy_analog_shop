<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω–∫–∞ - –¢–æ–≤–∞—Ä—ã</title>
</head>
<body>
    <h2>–ê–¥–º–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏</h2>
    <p>–¢—É—Ç –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–≤–∞—Ä–∞–º–∏.</p>

    <h3>–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h3>
    <table border="1">
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–¶–µ–Ω–∞</th>
                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
                <tr id="product-{{ product.id }}">
                    <td>{{ product.name }}</td>
                    <td>{{ product.price }}</td>
                    <td>{{ product.quantity }}</td>
                    <td>
                        <!-- –§–æ—Ä–º–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
                        <form action="/admin/products/edit/{{ product.id }}" method="post">
                            <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                            <input type="text" name="name" value="{{ product.name }}" required>
                            <br><br>

                            <label for="price">–¶–µ–Ω–∞:</label>
                            <input type="number" name="price" value="{{ product.price }}" required>
                            <br><br>

                            <label for="quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                            <input type="number" name="quantity" value="{{ product.quantity }}" required>
                            <br><br>

                            <button type="submit">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                        </form>

                        <!-- –§–æ—Ä–º–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ (—Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ AJAX) -->
                        <button onclick="deleteProduct({{ product.id }})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <br>

    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h3>
    <form action="/admin/products/add" method="post">
        <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
        <input type="text" name="name" required>
        <br><br>

        <label for="price">–¶–µ–Ω–∞:</label>
        <input type="number" name="price" required>
        <br><br>

        <label for="quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
        <input type="number" name="quantity" required>
        <br><br>

        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    </form>

    <!-- <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        function deleteProduct(id) {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?")) {
                fetch(`/admin/products/delete/${id}`, {
                    method: "POST"
                })
                .then(response => response.json())
                .then(data => {
                    alert(data.message); // –ü–æ–∫–∞–∂–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ —Ç–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω
                    // –£–¥–∞–ª–∏–º —Å—Ç—Ä–æ–∫—É —Ç–æ–≤–∞—Ä–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
                    document.getElementById(`product-${id}`).remove();
                })
                .catch(error => alert("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞!"));
            }
        }
    </script> -->

    <script>
        async function deleteProduct(id) {
            if (!confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?")) {
                return;
            }
    
            try {
                const response = await fetch(`/admin/products/delete/${id}`, {
                    method: "DELETE"
                });
    
                if (!response.ok) {
                    throw new Error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞! –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª: " + response.status);
                }
    
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª JSON
                const data = await response.json();
                
                // –£–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä –∏–∑ HTML
                const row = document.querySelector(`#product-${id}`);
                if (row) {
                    row.remove();
                }
    
                alert(data.message);
    
            } catch (error) {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: " + error.message);
            }
        }
    </script>
    
    
</body>
</html>

